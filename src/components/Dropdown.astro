---
const { options, selected, id, ...rest } = Astro.props as { options: { abbr?: string; name: string }[]; selected: string; id: string; [key: string]: any };
const selectedItem = options.find((option) => option.abbr === selected) || options[0];
---

<div id={id} data-selected={selected} {...rest}>
  <div id="data-container" data-id={id} class="selected">
    {selectedItem?.name}
  </div>
  <ul class="dropdown">
    {
      options.map((option: { name: string; abbr?: string }) => {
        return option.abbr ? (
          <li data-newoption={option.abbr} data-newoptionstring={option.name}>
            <a href="#">{option.name}</a>
          </li>
        ) : (
          <li data-newoption={option.name}>
            <a href="#">{option.name}</a>
          </li>
        )
      })
    }
  </ul>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    //This is owned by the component and used to transfer
    //some data (the id of the parent container) to the dropdown
    const selected: HTMLElement | null =
      document.querySelector("#data-container")
      
    const parentId = selected?.dataset.id
    if (parentId) {
      const parentContainer = document.getElementById(parentId)
      console.log("parentContainer: ", parentContainer)

      const dropdown = document.querySelector(".dropdown")
      if (selected && dropdown && parentContainer) {
        selected.addEventListener("click", () => {
          dropdown.classList.toggle("active")
        })
        const options = document.querySelectorAll(".dropdown li")
        options.forEach((option) => {
          option.addEventListener("click", (e) => {
            const newoption = (option as HTMLElement).dataset.newoption
            console.log("newoption: ", newoption)
            const newoptionstring = (option as HTMLElement).dataset.newoptionstring
            selected.textContent = newoptionstring || null

            dropdown.classList.remove("active")
            parentContainer.dataset.selection = newoption
          })
        })
      }
    }
  })
</script>

<style>
  .dropdown {
    display: none;
    position: absolute;
    translate: -50%;
    background-color: var(--clr-lightest);
    align-items: center;
    justify-items: center;
    padding: 0;
    flex-direction: column;
    align-items: center;

    li {
      border-bottom-color: var(--clr-darkest);
      border-bottom-style: solid;
      border-bottom-width: 2px;
      padding-inline: 1em;
      padding-block: 0.5em;
    }
  }
  .active {
    display: flex;
  }
</style>
