---
import Dropdown from "../components/Dropdown.astro"
//availablelocales is the short form list of languages that our translation supports
import { getLocale, locales as availableLocales } from "../paraglide/runtime.js"
//languagelist is just a static list of short form language names and full names
import languageList from "../data/languages.json" assert { type: "json" }

//languages available has both short and long form language names
//in the form {abbr: "en", name: "English"}
const languagesAvailable: { abbr: string; name: string }[] = []
availableLocales.forEach((element) => {
  const langObj = { abbr: element, name: languageList[element] }
  languagesAvailable.push(langObj)
})


//Gets the current locale from paraglide
const currentLocale = getLocale()


const languageName = availableLocales.find((locale) => locale === currentLocale)
// console.log("languageName: ", languageName)

const initialText = languageName
---

<Dropdown
  id="lang-dropdown"
  selected={languageName}
  options={languagesAvailable}
/>

<script>
  import { setLocale } from "../paraglide/runtime.js"

  document.addEventListener("DOMContentLoaded", () => {
    const langButton = document.getElementById(
      "lang-dropdown"
    ) as HTMLElement | null
    if (langButton) {
      langButton.addEventListener("click", (e) => {
        const newLang = langButton.dataset.selection
        if (newLang) {
          setLocale(newLang as "en" | "de" | "es")
        }
      })
    }
  })
</script>
